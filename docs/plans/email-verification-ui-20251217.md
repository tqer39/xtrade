# メール認証導線の実装計画 (2025/12/17)

## 概要

メール認証機能のバックエンドは完全に実装済みだが、**UI への統合が未実装**だった。
ユーザーがメール認証にアクセスする導線を構築した。

## 問題と解決

| 項目 | 実装前 | 実装後 |
| --- | --- | --- |
| バックエンド API | ✅ | ✅ |
| メール送信 | ✅ | ✅ |
| 認証フロー | ✅ | ✅ |
| `AddEmailForm` | ✅ 未使用 | ✅ 使用中 |
| 設定ページ | ❌ | ✅ `/settings` |
| ナビゲーション | ❌ | ✅ 設定ボタン追加 |

---

## 実装内容

### 1. 設定ページ `/settings` の作成

**新規ファイル**: `app/settings/page.tsx`

- 認証必須ページ（未ログインはホームにリダイレクト）
- `AddEmailForm` コンポーネントを配置
- ユーザーの現在のメールアドレスと認証状態を表示
- 認証完了後のリダイレクト対応（`?email_verified=true`）

### 2. ナビゲーションへの設定リンク追加

**修正ファイル**: `src/components/auth/user-menu.tsx`

UserMenu に設定アイコンボタンを追加:

```text
[ユーザーアイコン] [管理画面(admin)] [設定] [ログアウト]
```

---

## 変更ファイル一覧

| ファイル | 変更内容 |
| --- | --- |
| `app/settings/page.tsx` | 新規作成 |
| `src/components/auth/user-menu.tsx` | 設定ボタン追加 |

---

## 使用方法

1. ログイン後、ヘッダーの歯車アイコン（設定ボタン）をクリック
2. 設定ページでメールアドレスを入力
3. 「認証メールを送信」ボタンをクリック
4. メールを確認し、認証リンクをクリック
5. 認証完了後、設定ページにリダイレクト

## ローカルテスト（Mailpit）

1. `docker compose up -d`
2. `.env.local` に `MAIL_PROVIDER=mailpit` を設定
3. <http://localhost:8025> でメールを確認
